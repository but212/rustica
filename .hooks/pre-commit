#!/bin/bash
set -e

echo "Running pre-commit hooks..."

# Make sure we have the latest dependencies
cargo check --quiet

# Store the files that have been changed
STAGED_RS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "\.rs$" || true)

if [ -z "$STAGED_RS_FILES" ]; then
    echo "No Rust files to check. Skipping pre-commit hooks."
    exit 0
fi

# Format with rustfmt
echo "Running rustfmt..."
cargo fmt -- --check

# Lint with clippy
echo "Running clippy..."
cargo clippy --all -- -D warnings

# Run doctests specifically
echo "Running doctests..."
cargo test --doc

# If any of the above commands failed, the script will exit because of set -e
echo "âœ… Pre-commit checks passed!"
